<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Memory game</title>
</head>

<body>
  <div class="game-container">
    <script>
      function Card(front) {
        this.front = front
        this.visible = false
        this.complete = false

      }

      const newCardArray = function (newArrayLength) {
        return Array(newArrayLength).fill({}).map(function (item, index) {
          return new Card(index + 1)
        })
      }

      function Game(selector) {
        this.container = document.querySelector(selector)
        this.gameBoard = null
        this.scoreContainer = null
        this.deckOfCards = newCardArray(8).concat(newCardArray(8))

        this.numberOfCardsOnBoardSide = Math.sqrt(this.deckOfCards.length)
        this.cardDimension = (100 / this.numberOfCardsOnBoardSide) + '%'

        this.init()

      }



      Game.prototype.init = function () {
        this.makeGameBoard()
        this.render()
        this.shuffle(this.deckOfCards)
      }

      Game.prototype.makeGameBoard = function () {
        const board = document.createElement('div')
        board.style.width = '70vh'
        board.style.height = '70vh'
        board.style.backgroundColor = 'yellow'
        board.style.display = 'flex'
        board.style.flexWrap = 'wrap'
        board.style.justifyContent = 'center'

        board.className = 'game-board'

        this.container.appendChild(board)
        this.gameBoard = board
      }

      Game.prototype.render = function () {
        this.gameBoard.innerHTML = ''

        this.deckOfCards.forEach((card, index) => {
          this.renderSingleCard(card, index)
        })
      }

      Game.prototype.renderSingleCard = function (card, index) {
        const cardElement = document.createElement('div')
        cardElement.style.width = this.cardDimension
        cardElement.style.height = this.cardDimension
        cardElement.style.backgroundColor = 'red'

        if (card.visible) {
          cardElement.innerText = card.front
        }

        if (card.complete) {
          cardElement.innerText = card.front + 'competed'
        }

        cardElement.addEventListener(
          'click',
          () => this.toggleCard(index)
        )

        this.gameBoard.appendChild(cardElement)
      }



      Game.prototype.getVisibleCards = function () {
        let visibleCards = this.deckOfCards.filter(function (card, index) {
          return card.complete === false && card.visible === true
        })
        return visibleCards
      }

      Game.prototype.toggleCard = function (index) {
        this.makeVisibleCard(index)
        this.render()

        setTimeout(() => {
          if (this.getVisibleCards().length > 1) {
          if (this.checkIfVisibleCardIsAMatch()) {
            this.completeVisibleCard()
          }
        }
        this.render()
        },2000)

        
      }

      Game.prototype.makeVisibleCard = function (index) {
        this.deckOfCards[index] = Object.assign(this.deckOfCards[index], {
          visible: true
        });
      }

      
      Game.prototype.checkIfVisibleCardIsAMatch = function () {
        const visibleCards = this.getVisibleCards()
        if (visibleCards[0].front === visibleCards[1].front) { //To do use this.decOfCards instead of cisibleCards
          visibleCards[0].complete = true 
          visibleCards[1].complete = true
          console.log('rowne')
        } else {
          visibleCards[0].visible = false
          visibleCards[1].visible = false
          console.log('różne')
        }
        console.log(this.getVisibleCards())
        // if (this.deckOfCards(front) === this.deckOfCards(front)) { 
        //   console.log('')
        //   return true
        // }
      }

      Game.prototype.completeVisibleCard = function () {
        return this.deckOfCards.complete = true
      }

      Game.prototype.compareVisibleCards = function () {
        let compareVisibleCards = this.deckOfCards.filter(function (card) {
          return card.complete === true && card.visible === true
        }).length
      }




      Game.prototype.shuffle = function (array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
      }

      const newGame = new Game('body')
    </script>
  </div>
  <!-- <script src="game.js"></script> -->
</body>

</html>